tinymce.PluginManager.add("codemirror",function(editor){function showDialog(){var win=editor.windowManager.open({title:"Source code",body:{type:"textbox",name:"code",multiline:true,minWidth:editor.getParam("code_dialog_width",800),minHeight:editor.getParam("code_dialog_height",Math.min(tinymce.DOM.getViewPort().h-200,500)),spellcheck:false,style:"direction: ltr; text-align: left"},onSubmit:function(e){codeEditor.save();codeEditor.toTextArea();content=$(codeEditor.getTextArea()).val();editor.focus();editor.undoManager.transact(function(){editor.setContent(content)});editor.selection.setCursorLocation();editor.nodeChanged()}});win.find("#code").value(editor.getContent({source_view:true}).split(">").join(">\n"));requireCss("codemirror.css");requireCss("tinymce/plugins/codemirror/plugin.css");require("codemirror/lib/codemirror.js");require("codemirror/mode/htmlmixed/htmlmixed.js");require("codemirror/mode/css/css.js");require("codemirror/mode/xml/xml.js");require("codemirror/mode/javascript/javascript.js");require("codemirror/lib/formating.js")}function getSelectedRange(codeEditor){return{from:codeEditor.getCursor(true),to:codeEditor.getCursor(false)}}function autoFormatSelection(codeEditor){var range=getSelectedRange(codeEditor);codeEditor.autoFormatRange(range.from,range.to)}function commentSelection(isComment,codeEditor){var range=getSelectedRange();codeEditor.commentRange(isComment,range.from,range.to)}function initCodeMirror(){var skin_links=$('link[href$="http://localhost:3000/assets/tinymce/skins/lightgray/skin.min.css"]');var number_of_skins_loaded=skin_links.size();if(number_of_skins_loaded>1){for(i=1;i<number_of_skins_loaded;i++){skin_links[i].remove()}}codeEditor=CodeMirror.fromTextArea($("textarea.mce-textbox").get(0),{mode:{name:"htmlmixed"},tabMode:"indent",lineNumbers:true,height:400});CodeMirror.commands["selectAll"](codeEditor);autoFormatSelection(codeEditor)}editor.addCommand("CodeMirror",showDialog);editor.addButton("codemirror",{icon:"code",tooltip:"Source code",onclick:showDialog});editor.addMenuItem("codemirror",{icon:"code",text:"codeMirror code",context:"tools",onclick:function(){showDialog();setTimeout(function(){initCodeMirror()},500)}})});
